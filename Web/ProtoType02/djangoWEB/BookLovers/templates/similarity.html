<!DOCTYPE HTML>
<!--
	Binary by TEMPLATED
	templated.co @templatedco
	Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
{% load static %}

<html>
	<head>
		<title>Similar Popularity</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="{% static 'BookLovers/assets/css/main.css' %}" />
	</head>
	<style>
		.first {
			float: left;
			width: 48%;
			margin-left: 20px;
		}

		.second {
			float: right;
			width: 48%;
			margin-right: 20px;
		}
	</style>

	<body>
		<!-- Header -->
		<header id="header">
			<a href="../index" class="logo"><strong>Book Lovers</strong></a>
			<nav>
				<a href="#menu">Menu</a>
			</nav>
		</header>


		<!-- Nav -->
		<nav id="menu">
			<ul class="links">
				<li><a href="../index">Home</a></li>
				<li><a href="../index/category">Category</a></li>
				<li><a href="../index/mbti">MBTI</a></li>
				<li><a href="../index/healing">Healing</a></li>
				<li><a href="../index/similarity">Similarity</a></li>
			</ul>
		</nav>


		<!-- Main -->
		<section id="main">
			<div class="inner">
				<header>
					<p class="info">Similar Popularity</p>
				</header>
			</div>
			<div class="first">
				<form method="post" action="search">
					{% csrf_token %}
					<input type="text" placeholder="검색어를 입력해주세요." name="word"/>
					<button type="submit">검색</button>
				</form>
			</div>

			<div class="second">

			</div>
		</section>


		<!-- Scripts -->
		<script src="{% static 'BookLovers/assets/js/jquery.min.js' %}"></script>
		<script src="{% static 'BookLovers/assets/js/jquery.scrolly.min.js' %}"></script>
		<script src="{% static 'BookLovers/assets/js/skel.min.js' %}"></script>
		<script src="{% static 'BookLovers/assets/js/util.js' %}"></script>
		<script src="{% static 'BookLovers/assets/js/main.js' %}"></script>
		<script>
			$(document).ready(function() {
				$('#searchBtn').click(function() {
					$('#tbody').empty()

					// ajax 통신 - json
					$.ajax({
						url : "{% url 'category_info' %}",
						type : "post",
						data : {'csrfmiddlewaretoken' : '{{ csrf_token }}', ageType : $('#ageType').val(), genreType : $('#genreType').val(), genderType : $('#genderType').val()},
						dataType : "json",
						success : function(data) {
							var txt = "";

							$.each(data , function(idx, obj) {
								txt += "<tr><td align='center' vertical-align='middle'><a href='javascript:void(0);' onclick='callFunction(" + obj.isbn13 + ");'>" + obj.bookname + "</a></td>";
								txt += "<td style='text-align: center'>" + "<img src='" + obj.bookImageURL + "' width='82px' height='113px'/>" + "</td></tr>";
							});

							$("#tbody").append(txt);
						}
					})
				})
			})
		</script>
		<script>
			function callFunction(isbn13) {
				$('#bookInfo').empty()

				// ajax 통신 - json
				$.ajax({
					url : "{% url 'book_info' %}",
					type : "post",
					data : {'csrfmiddlewaretoken' : '{{ csrf_token }}', isbn : isbn13},
					dataType : "json",
					success : function(data) {
						var txt = "";

						$.each(data , function(idx, obj) {
							txt += "<p style='float: right; margin-right: 50px'>" + "<img src='" + obj.bookImageURL + "' width='200' height='302'/>" + "</p>";
							txt += "<h2>" + obj.bookname + "</h2>";
							txt += "<dl><dt>저자</dt><dd>" + obj.authors + "</dd><br/>";
							txt += "<dt>출판사</dt><dd>" + obj.publisher + "</dd><br/>";
							txt += "<dt>출판년도</dt><dd>";
							if (obj.publication_year.length != 0)
								txt += obj.publication_year;
							else
								txt += "~";
							txt += "</dd><br/>";
							txt += "<dt>책 소개</dt><dd>" + obj.description + "</dd></dl>";
						});

						$("#bookInfo").append(txt);
					}
				})
			}
		</script>

	</body>
</html>
