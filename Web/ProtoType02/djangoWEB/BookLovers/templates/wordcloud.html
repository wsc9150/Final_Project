<!DOCTYPE html>
{% load static %}

<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Title</title>

        <script src="https://d3js.org/d3.v4.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3.layout.cloud.js"></script>
    </head>

    <body>
        <h1>WordCloud Page</h1>

        <script>
            var width = 1000,
                height = 800

            var svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height);

            d3.csv("{% static 'BookLovers/wordcloud_keyword_cnt_over10.csv' %}", function (data) {
                showCloud(data)
                showCloud(data)
            });

            wordScale = d3.scaleLinear().domain([10, 300]).range([0, 150]);


            function showCloud(data) {
                d3.layout.cloud().size([width, height])
                    //클라우드 레이아웃에 데이터 전달
                    .words(data)
                    .rotate(function (d) {
                        return 0;
                    })
                    //스케일로 각 단어의 크기를 설정
                    .fontSize(function (d) {
                        return wordScale(d.cnt);
                    })
                    //클라우드 레이아웃을 초기화 > end 이벤트 발생 > 연결된 함수 작동
                    .on("end", draw)
                    .start();


                function draw(words) {
                    var cloud = svg.selectAll("text").data(words)
                    //Entering words
                    cloud.enter()
                        .append("text")
                        .attr("text-anchor", "middle")
                        .attr('font-size', 1)
                        .text(function (d) {
                            return d.keyword;
                        });

                    cloud
                        .transition()
                        .duration(600)
                        .style("font-size", function (d) {
                            return d.size + "px";
                        })
                        .attr("transform", function (d) {
                            return "translate(" + [d.x + 450, d.y + 400] + ")rotate(" + d.rotate + ")";
                        })
                        .style("fill-opacity", 1);
                    }
                }
        </script>
    </body>
</html>
